name: Notify release branch change

on:
  # trigger for main and release branches.
  push:
    branches:
      - main
      - release/*

jobs:
  pingRemote:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@master

      - name: Get branch name (merge)
        shell: bash
        run: echo "BRANCH_NAME=$(echo ${GITHUB_REF#refs/heads/} | tr / -)" >> $GITHUB_BRANCH

      - name: 'Ping remote repository'
        run: |
          if (-not $Env:ORG) {
            Write-Host "Org is missing."
            exit 1
          }
          if (-not $Env:REPO) {
            Write-Host "Repository is missing."
            exit 1
          }

          Import-Module $Env:GITHUB_WORKSPACE/tools/devops/automation/scripts/GitHub.psm1
          Write-Host "Ping from branch $Env:GITHUB_BRANCH"
          Push-RepositoryDispatch -Org $Env:ORG -Repo $Env:REPO -Branch $Env:GITHUB_BRANCH
        shell: pwsh
        env:
          GITHUB_TOKEN: ${{ secrets.access-token }}
          ORG: ${{ secrets.org}}
          REPO: ${{ secrets.repo}}
