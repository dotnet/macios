# common steps to download the artifacts from the test results.
parameters:

- name: testPrefix
  type: string 
  default: 'ios' # default context, since we started dealing with iOS devices. 

- name: runTests
  type: boolean
  default: true

- name: label
  type: string

steps:

- ${{ if eq(parameters.runTests, true) }}:
  # Download the test report to write the comment.
  - task: DownloadPipelineArtifact@2
    displayName: Download Test Summary
    inputs:
      patterns: "**/TestSummary-${{ parameters.testPrefix }}${{ replace(parameters.label, '-', '_') }}/TestSummary.md"
      allowFailedBuilds: true
      path: $(System.DefaultWorkingDirectory)\Reports

  - powershell: |
      $label="${{ replace(parameters.label, '-', '_') }}"
      Write-Host "##vso[task.setvariable variable=TEST_SUMMARY_PATH_$($label.ToUpper())]$Env:SYSTEM_DEFAULTWORKINGDIRECTORY\Reports\TestSummary-${{ parameters.testPrefix }}$label\TestSummary.md"
    displayName: Publish artifact paths
    name: artifacts_${{ replace(parameters.label, '-', '_') }} # not to be confused with the displayName, this is used to later use the name of the step to access the output variables from an other job
